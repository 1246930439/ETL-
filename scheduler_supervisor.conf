# Supervisor配置文件
# 部署时请复制到 /etc/supervisor/conf.d/scheduler.conf

[program:scheduler]
# 启动命令 - 使用虚拟环境中的gunicorn
command=/var/www/scheduler/venv/bin/gunicorn -c gunicorn.conf.py web_scheduler:app

# 工作目录
directory=/var/www/scheduler

# 运行用户
user=www-data

# 自动启动
autostart=true

# 自动重启
autorestart=true

# 启动延迟(秒)
startsecs=10

# 停止信号
stopsignal=INT

# 停止等待时间(秒)
stopwaitsecs=10

# 重定向标准错误到标准输出
redirect_stderr=true

# 标准输出日志文件
stdout_logfile=/var/log/scheduler/scheduler.log

# 日志文件大小限制(MB)
stdout_logfile_maxbytes=50MB

# 保留的日志文件数量
stdout_logfile_backups=10

# 环境变量
environment=PATH="/var/www/scheduler/venv/bin"

# 进程优先级(-20最高，19最低)
priority=999

# 进程组
[group:scheduler]
programs=scheduler

# 事件监听器配置
[eventlistener:quit_on_failure]
events=PROCESS_STATE_FATAL
command=/usr/local/sbin/supervisor_mailer.py -m admin@example.com